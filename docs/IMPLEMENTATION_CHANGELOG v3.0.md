## Version **3.0**

**Component:** Observer
**Role:** Infrastructure
**Language:** STRICT MQL5
**Status:** STABLE / ACCEPTED
**Authority:** TECH SPEC ‚Äî Observer v1.1, SSP v3.0

---

## üéØ Summary

–í–µ—Ä—Å–∏—è **3.0** —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç **–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∏ –ø—Ä–∏–Ω—è—Ç—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Observer v1.1**, –≤–∫–ª—é—á–∞—è:

* –ø–æ–¥–¥–µ—Ä–∂–∫—É **multi-timeframe —Ç—Ä–µ–Ω–¥–æ–≤**,
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é baseline-–º–æ–¥–µ–ª—å —Ç—Ä–µ–Ω–¥–∞,
* –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä **black-box —Ç–µ—Å—Ç–æ–≤**,
* —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –±–ª–æ–∫–µ—Ä–æ–≤,
* —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SSP / Lexicon / Naming Rules.

–í–µ—Ä—Å–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è **—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ç–æ—á–∫–æ–π** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞.

---

## ‚úÖ Added

### 1. Snapshot.trends (Multi-Timeframe)

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:

* `Snapshot.trends.count`
* `Snapshot.trends.items[] : TrendInfo`

–î–ª—è –∫–∞–∂–¥–æ–≥–æ TF –∏–∑ `OBS_TF_LIST` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω `TrendInfo`.

---

### 2. Baseline Trend Model (Deterministic)

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å:

* lookback = **3 –∑–∞–∫—Ä—ã—Ç—ã—Ö –±–∞—Ä–∞**
* `direction ‚àà {-1,0,+1}`
* `regime ‚àà {TREND, RANGE, UNKNOWN}`
* `confidence ‚àà {0.0, 0.5, 1.0}`

–ú–æ–¥–µ–ª—å:

* **–Ω–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è**
* –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
* –ø–æ–¥–ª–µ–∂–∏—Ç –∑–∞–º–µ–Ω–µ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö

---

### 3. Startup Configuration

–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä:

```mq5
input string OBS_TF_LIST;
```

* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ whitespace
* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞
* fail-fast –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ
* Snapshot –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

### 4. –ü–æ–ª–Ω—ã–π Test Suite (Observer v1.1)

–î–æ–±–∞–≤–ª–µ–Ω –∏ –ø—Ä–∏–Ω—è—Ç —Ç–µ—Å—Ç-—Å—å—é—Ç:

```
tests/Infrastructure/Observer/TC_ObserverTests.mqh
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤:

* black-box
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
* –±–µ–∑ MT5 market API –≤–Ω–µ Observer
* startup-based –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
* –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∞ –Ω–µ –ª–æ–≥–∏–∫–∏ —Ä—ã–Ω–∫–∞

---

## üîß Changed

### 1. Observer_Run

* Observer —Ç–µ–ø–µ—Ä—å **–∑–∞–ø–æ–ª–Ω—è–µ—Ç –í–°–ï —Å–µ–∫—Ü–∏–∏ Snapshot**
* —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥—ë–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç `Observer_Run(Snapshot&)`
* –∏—Å–∫–ª—é—á–µ–Ω–æ –ª—é–±–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏

---

### 2. Trend Computation Logic

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ:

* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ `TREND / RANGE / UNKNOWN`
* —è–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è `< 3 –±–∞—Ä–æ–≤`
* –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `confidence = 0.5`
* —É–±—Ä–∞–Ω–∞ –Ω–µ—è–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã

---

### 3. Timeframe Parsing

* —É–¥–∞–ª–µ–Ω–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –Ω–∞–¥ enum
* —Ä–∞–∑—Ä–µ—à–µ–Ω—ã **–¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–µ ENUM_TIMEFRAMES MT5**
* –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ TF ‚Üí fail-fast

---

## üêû Fixed

* ‚ùå –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `confidence = 0.5` –≤ —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö
* ‚ùå –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ minute TF (`PERIOD_M1 * v`)
* ‚ùå –Ω–µ—è–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `UNKNOWN`
* ‚ùå –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è black-box —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
* ‚ùå –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö

–í—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ BLOCKER‚Äô—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã.

---

## üîí Compliance

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:

* SSP v3.0
* CONTRACT_LEXICON v3.x
* NAMING_RULES v1.0
* ROLE_CALL_CONTRACTS v0.1

–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è**:

* `#pragma once`
* `(void)`
* `static` —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `.mqh`
* –Ω–æ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–∏–ø—ã

---

## üß™ Verification

* ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã `TC_ObserverTests.mqh` ‚Äî **PASS**
* ‚úÖ –î–µ—Ç–µ–º–∏–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
* ‚úÖ Black-box –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ–±–ª—é–¥–µ–Ω—ã
* ‚úÖ Backward compatibility —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (single TF)

---

## üìå Notes

* `is_new_bar`, `bars_since_entry`, `bars_since_last_action` –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ baseline (0 / false)
* –í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Äî **–Ω–µ —á–∞—Å—Ç—å v3.0**

---

## üü¢ Status

**Observer v1.1 ‚Üí IMPLEMENTED, TESTED, ACCEPTED**
**Release tag:** `v3.0`

---

### **v3.0 ‚Äî TrendAnalyzer introduced (baseline analytical module)**

**Date:** 2025-12-25
**Status:** ACCEPTED
**Scope:** Infrastructure / Analytics (non-trading)

---

### ‚úÖ Added

* **TrendAnalyzer v0.1** ‚Äî –Ω–æ–≤—ã–π **—á–∏—Å—Ç—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è **–ø–æ –æ–¥–Ω–æ–º—É —Ç–∞–π–º—Ñ—Ä–µ–π–º—É**.
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞:

  * EMA slope (EMA-50, lookback = 5),
  * ADX (14) –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä —Ç—Ä–µ–Ω–¥–∞,
  * ATR (14) –∫–∞–∫ –∞–º–ø–ª–∏—Ç—É–¥–Ω—ã–π guard.
* –í–≤–µ–¥—ë–Ω —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:

  * `regime ‚àà {TREND, RANGE, UNKNOWN}`
  * `direction ‚àà {-1, 0, +1}` (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å CONTRACT_LEXICON)
  * `confidence ‚àà [0.0 ‚Ä¶ 1.0]`
* –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö** (`MIN_BARS = 55`):

  * `UNKNOWN / direction=0 / confidence=0.0`
* –û–±–µ—Å–ø–µ—á–µ–Ω—ã —Å—Ç—Ä–æ–≥–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:

  * `regime != TREND ‚áí direction == 0`
  * `RANGE, UNKNOWN ‚áí confidence == 0.0`

---

### üß™ Testing

* –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π **black-box test suite**:

  ```
  tests/TrendAnalyzer/TC_TrendAnalyzerTests.mqh
  ```
* –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

  * –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã,
  * –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö,
  * —Å–µ–º–∞–Ω—Ç–∏–∫—É RANGE / TREND,
  * –≥—Ä–∞–Ω–∏—Ü—ã confidence,
  * –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º,
  * compile-time –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Observer / Snapshot.
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π **script-runner** –¥–ª—è —Ç–µ—Å—Ç–æ–≤ TrendAnalyzer.
* –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ.

---

### üîí Architectural Notes

* TrendAnalyzer:

  * **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Observer**
  * **–Ω–µ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã**
  * **–Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π**
  * **–Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ**
* –ú–æ–¥—É–ª—å –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫:

  * **Replaceable**
  * **Baseline reference implementation**
  * –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (v0.x ‚Üí v1.x).

---

### ‚ùå Not Included

* –ê–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
* –õ—é–±–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
* –°–≤—è–∑—å —Å DecisionMaker / Coordinator
* ML / —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏

---

### üß≠ Impact Summary

‚úîÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞
‚úîÔ∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
‚úîÔ∏è –ù–æ–≤—ã–µ —Ä–æ–ª–∏ –Ω–µ –≤–≤–µ–¥–µ–Ω—ã
‚úîÔ∏è –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω –±–µ–∑ coupling

---

**END OF CHANGELOG ENTRY**

