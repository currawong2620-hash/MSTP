# üü• TECH SPEC ‚Äî FeedbackSource v1.0 (AUDIT-REVISED)

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform (MQL5)
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Infrastructure
**–†–æ–ª—å:** `FeedbackSource`
**–í–µ—Ä—Å–∏—è:** v1.0
**–°—Ç–∞—Ç—É—Å:** Draft ‚Üí Master-Chat approval

**–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è:**
SSP v1.0, CONTRACT_LEXICON v1.1, NAMING_RULES v1.0,
ROLE_CALL_CONTRACTS_MQL5 v0.1, Architecture Data Flow Model v1.0,
Visual Observability Model v1.0

---

## 0. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`FeedbackSource` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç **–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å (`Feedback`)**
–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö **–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞**,
–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è** –∑–∞–º–µ–Ω—è–µ–º—ã—Ö —Ä–æ–ª–µ–π.

`FeedbackSource`:

* **–ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–π**
* **–ù–ï –≤–ª–∏—è–µ—Ç** –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
* **–ù–ï —á–∏—Ç–∞–µ—Ç** —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –∏–ª–∏ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
* **–ù–ï —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç** –º–µ—Ö–∞–Ω–∏–∫—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* **–ù–ï –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞–Ω–∏—è –æ —Ö–æ–¥–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**

`Feedback` —è–≤–ª—è–µ—Ç—Å—è **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–æ–ø—É—Å—Ç–∏–º—ã–º –∫–∞–Ω–∞–ª–æ–º –ø–∞–º—è—Ç–∏ —Å–∏—Å—Ç–µ–º—ã**.

---

## 1. –ü—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–ù–û–†–ú–ê–¢–ò–í–ù–û)

```mq5
void FeedbackSource_Run(
    const ExecutionResult &results[],
    const int results_count,
    Feedback &out_feedback
);
```

–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞.
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–æ–ª–∏

### 2.1 –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Executor ‚Üí ExecutionResult[]
                ‚Üì
           FeedbackSource
                ‚Üì
              Feedback
                ‚Üì
     DecisionMaker / PositionPolicyManager
```

`FeedbackSource` **–ù–ï –∑–Ω–∞–µ—Ç** –æ `Decision`, `Intent`,
–æ —Ñ–∞–∫—Ç–µ –≤—ã–∑–æ–≤–∞ –∏–ª–∏ –Ω–µ–≤—ã–∑–æ–≤–∞ `Executor`,
–∏ –æ –≤–Ω–µ—à–Ω–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å—Ä–µ–¥—ã.

---

## 3. –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –≤—Ö–æ–¥—ã (–°–¢–†–û–ì–û)

`FeedbackSource` –ò–ú–ï–ï–¢ –ü–†–ê–í–û —á–∏—Ç–∞—Ç—å **–¢–û–õ–¨–ö–û**:

1. `ExecutionResult[]`

   * –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π Coordinator‚Äô–æ–º
   * –∫–∞–∫ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–∫—Ç–æ–≤**

–ó–∞–ø—Ä–µ—â–µ–Ω–æ —á–∏—Ç–∞—Ç—å:

* `Snapshot`
* —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
* —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç–∞ / equity
* `Intent`
* `PolicyAdjustedIntent`
* `Decision`
* –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞ –∏–ª–∏ —Å—Ä–µ–¥—ã

`FeedbackSource` **–ù–ï —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç—ã
–∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –∏ **–ù–ï –Ω–∞–±–ª—é–¥–∞–µ—Ç —Å—Ä–µ–¥—É –Ω–∞–ø—Ä—è–º—É—é**.

---

## 4. –í—ã—Ö–æ–¥–Ω–æ–π —Ç–∏–ø: Feedback (—Å—Ç—Ä–æ–≥–æ –ø–æ Lexicon v1.1)

```text
Feedback
‚îú‚îÄ‚îÄ event
‚îú‚îÄ‚îÄ pnl
‚îî‚îÄ‚îÄ message
```

### 4.1 –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è

* `Feedback` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è **–í–°–ï–ì–î–ê**
* —Ä–æ–≤–Ω–æ **–æ–¥–∏–Ω** `Feedback` –Ω–∞ —Ü–∏–∫–ª
* –¥–∞–∂–µ –µ—Å–ª–∏ `results_count = 0`

---

## 5. –ü–æ–ª–µ `event` (–ù–û–†–ú–ê–¢–ò–í–ù–û)

### 5.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`event` –æ—Ç—Ä–∞–∂–∞–µ—Ç **–°–ú–´–°–õ–û–í–û–ô –§–ê–ö–¢**,
**–≤—ã–≤–æ–¥–∏–º—ã–π –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û –∏–∑ `ExecutionResult[]`**,
–±–µ–∑ –∑–Ω–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω –∏ —Ö–æ–¥–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏.

---

### 5.2 –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (`feedback_event`)

* `POSITION_OPENED`
* `POSITION_CLOSED`
* `STOP_HIT`
* `TARGET_HIT`

–ó–Ω–∞—á–µ–Ω–∏–µ `ACTION_REJECTED`
**–ù–ï —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è FeedbackSource v1.0**.

---

### 5.3 –ü—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `event`

* –µ—Å–ª–∏ `ExecutionResult[]` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–∫—Ç,
  —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ—Ç–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–∏
  ‚Üí `POSITION_OPENED`
* –µ—Å–ª–∏ `ExecutionResult[]` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–∫—Ç,
  —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–∏
  ‚Üí `POSITION_CLOSED`
* –µ—Å–ª–∏ `ExecutionResult[]` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–∫—Ç–æ–≤,
  –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã—Ö –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ:

  > `event` **–û–°–¢–ê–Å–¢–°–Ø —Ä–∞–≤–Ω—ã–º –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é**

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ**
–∏ **–ù–ï —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–∑–∞–≤–∏—Å–∏–º—ã–º**.

---

## 6. –ü–æ–ª–µ `pnl` (–ù–û–†–ú–ê–¢–ò–í–ù–û)

### 6.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`pnl` ‚Äî **–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª**,
–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è,
–∞ –Ω–µ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### 6.2 –ò—Å—Ç–æ—á–Ω–∏–∫ –∏ –ø—Ä–∞–≤–∏–ª–∞

* `pnl` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** –∏–∑ `ExecutionResult[]`
* –±–µ–∑ —á—Ç–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—á—ë—Ç–∞ –∏–ª–∏ –ø–æ–∑–∏—Ü–∏–∏
* –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
* –±–µ–∑ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è R/R –∏–ª–∏ execution-–º–µ—Ç—Ä–∏–∫

–î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è:

* `pnl = 0`, –µ—Å–ª–∏ –∏–∑ `ExecutionResult[]`
  –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç

---

## 7. –ü–æ–ª–µ `message` (–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–û)

### 7.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`message` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** –¥–ª—è:

* –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
* –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
* –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —á–µ–ª–æ–≤–µ–∫–æ–º

---

### 7.2 –ó–∞–ø—Ä–µ—Ç—ã

* `message` **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –ª–æ–≥–∏–∫–µ
* **–ù–ï –ø–∞—Ä—Å–∏—Ç—Å—è**
* **–ù–ï –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è** –Ω–∏–∫–∞–∫–æ–π —Ä–æ–ª—å—é

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `message` –≤ –ª–æ–≥–∏–∫–µ
—Å—á–∏—Ç–∞–µ—Ç—Å—è **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –¥–µ—Ñ–µ–∫—Ç–æ–º**.

---

## 8. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ö–†–ò–¢–ò–ß–ï–°–ö–ò)

`FeedbackSource` **–û–ë–Ø–ó–ê–ù**:

* –±—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
* —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å Feedback –Ω–∞ –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `ExecutionResult[]`
* –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ —Ä—ã–Ω–∫–∞

`FeedbackSource` **–ó–ê–ü–†–ï–©–ï–ù–û**:

* –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã –æ `Decision`
* –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã –æ —Ö–æ–¥–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
* —É–≥–∞–¥—ã–≤–∞—Ç—å ‚Äú—á—Ç–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ‚Äù
* —á–∏—Ç–∞—Ç—å –≤–Ω–µ—à–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

## 9. Visual Observability

### 9.1 Feedback Loop Viewer

–î–ª—è —Ä–æ–ª–∏ `FeedbackSource` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä,
–≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π **–¢–û–õ–¨–ö–û `Feedback`**:

* `event`
* `pnl`
* `message`

–¢–µ—Å—Ç–µ—Ä:

* read-only
* –±–µ–∑ –ª–æ–≥–∏–∫–∏
* –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É

---

## 10. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (AUDIT)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –µ—Å–ª–∏:

* ‚ùè `Feedback` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞
* ‚ùè —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω Feedback –Ω–∞ —Ü–∏–∫–ª
* ‚ùè –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `ExecutionResult[]`
* ‚ùè –Ω–µ—Ç —á—Ç–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ —Å—á—ë—Ç–∞
* ‚ùè `event` –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–∑ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö
* ‚ùè –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ ‚Äú–Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π‚Äù –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
* ‚ùè `pnl` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* ‚ùè —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–º–µ–Ω—è–µ–º–∞ –±–µ–∑ –ø—Ä–∞–≤–æ–∫ FeedbackSource

---

## 11. Freeze Rule

–ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

> üîí **FeedbackSource v1.0 –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è**

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã **–¢–û–õ–¨–ö–û** —á–µ—Ä–µ–∑:

* –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Lexicon
* –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é FeedbackSource

---

## 12. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å

> **–ú–æ–∂–Ω–æ –ª–∏, –∏–º–µ—è —Ç–æ–ª—å–∫–æ `ExecutionResult[]`,
> –ø–æ–ª—É—á–∏—Ç—å –≤–µ—Å—å `Feedback`?**

* –î–∞ ‚Üí ‚úÖ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
* –ù–µ—Ç ‚Üí ‚ùå –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ

---

**END OF TECH SPEC ‚Äî FeedbackSource v1.0 (AUDIT-REVISED)**

