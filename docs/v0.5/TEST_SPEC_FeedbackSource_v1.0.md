# üü• TEST SPEC ‚Äî FeedbackSource v0.1 (AUDIT-REVISED)

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform (MQL5)
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Infrastructure
**–¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è —Ä–æ–ª—å:** `FeedbackSource`
**–í–µ—Ä—Å–∏—è —Ç–µ—Å—Ç-—Å–ø–µ–∫–∏:** v0.1
**–°—Ç–∞—Ç—É—Å:** Draft ‚Üí Master-Chat approval

**–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è:**
SSP v1.0, CONTRACT_LEXICON v1.1,
ROLE_CALL_CONTRACTS_MQL5 v0.1,
TECH SPEC ‚Äî FeedbackSource v1.0 (AUDIT-REVISED)

---

## 0. –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–î–∞–Ω–Ω—ã–π TestSpec –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω **–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

* –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `FeedbackSource`
* —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è

TestSpec **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**:

* —Ç–æ—Ä–≥–æ–≤—É—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
* —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Å–º—ã—Å–ª `pnl`
* —Ä–µ–∞–ª–∏–∑–º —Å–æ–±—ã—Ç–∏–π
* —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏

---

## 1. –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

1. –í—Å–µ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç **–¢–û–õ–¨–ö–û** —á–µ—Ä–µ–∑:

   ```mq5
   FeedbackSource_Run(...)
   ```
2. –í —Ç–µ—Å—Ç–∞—Ö **–ó–ê–ü–†–ï–©–ï–ù–û**:

   * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MT5 API
   * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Snapshot`
   * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ —Å—á—ë—Ç–∞
   * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞–Ω–∏—è –æ Coordinator
3. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤ ‚Äî **–¢–û–õ–¨–ö–û `ExecutionResult[]`**.
4. –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç ‚Äî **—á–∏—Å—Ç—ã–π –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π**.
5. –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã**.

---

## 2. –ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ (–ú–ò–ù–ò–ú–ê–õ–¨–ù–û –î–û–ü–£–°–¢–ò–ú–´–ô)

### FS-1 ‚Äî Determinism

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `FeedbackSource_Run` —è–≤–ª—è–µ—Ç—Å—è
**—á–∏—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –æ—Ç `ExecutionResult[]`**.

**–í—Ö–æ–¥:**

* –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –º–∞—Å—Å–∏–≤ `ExecutionResult[]`
* –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `results_count`

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event` ‚Äî –∏–¥–µ–Ω—Ç–∏—á–µ–Ω
* `Feedback.pnl` ‚Äî –∏–¥–µ–Ω—Ç–∏—á–µ–Ω
* `Feedback.message` ‚Äî –∏–¥–µ–Ω—Ç–∏—á–µ–Ω

**–ó–∞–ø—Ä–µ—Ç—ã:**

* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–∑–æ–≤–æ–≤
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

### FS-2 ‚Äî Zero ExecutionResult

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
–ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–∫—Ç–æ–≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í—Ö–æ–¥:**

```mq5
results_count = 0
results = {}
```

**–û–∂–∏–¥–∞–Ω–∏–µ (–ù–û–†–ú–ê–¢–ò–í–ù–û):**

* `Feedback` —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω
* `Feedback.event` —Ä–∞–≤–µ–Ω
  **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é**,
  –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º–æ–º—É –∏–∑ Lexicon
  (–∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É enum-–∑–Ω–∞—á–µ–Ω–∏—é,
  –µ—Å–ª–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ)
* `Feedback.pnl = 0`
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤–∞—Ä–∏–π –∏–ª–∏ undefined behavior

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**

* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ‚Äú–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è‚Äù
* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤

---

### FS-3 ‚Äî Single ExecutionResult

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é –æ–¥–Ω–æ–≥–æ —Ñ–∞–∫—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
**–±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∏ –¥–æ–≥–∞–¥–æ–∫**.

**–í—Ö–æ–¥:**

* `results_count = 1`
* –æ–¥–∏–Ω –¥–æ–ø—É—Å—Ç–∏–º—ã–π `ExecutionResult`

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback` —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω
* `Feedback.event` **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è
  –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `ExecutionResult[]`**
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ:

  * –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏—á–∏–Ω
  * —á—Ç–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  * –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Äú–ø–æ —Å–º—ã—Å–ª—É‚Äù

---

### FS-4 ‚Äî Multiple ExecutionResult

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í—Ö–æ–¥:**

* `results_count >= 2`
* —Å–º–µ—à–∞–Ω–Ω—ã–µ `ExecutionResult.status`
  (EXECUTED / PARTIAL / FAILED)

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω `Feedback`
* `event` –≤—ã–≤–æ–¥–∏—Ç—Å—è **–¢–û–õ–¨–ö–û –∏–∑ –º–∞—Å—Å–∏–≤–∞ `ExecutionResult[]`**
* `FAILED` –∏ `PARTIAL` **–ù–ï –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è**
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–∏–ª–µ–Ω–∏–π –∏–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

---

### FS-5 ‚Äî Forbidden Event Emission

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

**–í—Ö–æ–¥:**

* –ª—é–±–æ–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π `ExecutionResult[]`

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event` **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ä–∞–≤–µ–Ω:

  * `ACTION_REJECTED`
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã–≤–æ–¥–∞ —Å–æ–±—ã—Ç–∏—è
  –∏–∑ —Ñ–∞–∫—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## 3. –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ) –ø—Ä–æ–≤–µ—Ä–∫–∏

### FS-N1 ‚Äî No External Reads (STATIC AUDIT)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
‚ùó **–î–∞–Ω–Ω—ã–π –ø—É–Ω–∫—Ç –ù–ï —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∫–∞–∫ runtime-—Ç–µ—Å—Ç.**
–û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **Audit-Chat‚Äô–æ–º** —á–µ—Ä–µ–∑
—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

* ‚ùå –Ω–µ —á–∏—Ç–∞–µ—Ç `Snapshot`
* ‚ùå –Ω–µ —á–∏—Ç–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
* ‚ùå –Ω–µ —á–∏—Ç–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç–∞
* ‚ùå –Ω–µ —á–∏—Ç–∞–µ—Ç `Decision`

–õ—é–±–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ ‚Üí ‚ùå FAIL.

---

### FS-N2 ‚Äî No Logic Leakage

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ö–æ—Å–≤–µ–Ω–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∫—Ä—ã—Ç–æ–π –ª–æ–≥–∏–∫–∏.

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è:**

* —Ä–∞–∑–ª–∏—á–Ω—ã–π `Feedback` –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º `ExecutionResult[]`
* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–∑–æ–≤–æ–≤
* –∏–∑–º–µ–Ω–µ–Ω–∏–µ `Feedback` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–õ—é–±–æ–π –ø—Ä–∏–∑–Ω–∞–∫ ‚Üí ‚ùå FAIL.

---

## 4. –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è TestSpec

`FeedbackSource v1.0` —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º, –µ—Å–ª–∏:

* ‚ùè FS-1 ‚Ä¶ FS-5 –ø—Ä–æ–π–¥–µ–Ω—ã
* ‚ùè FS-N1 –∏ FS-N2 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
* ‚ùè –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ø—É—Å–∫–∞—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
  –∫–∞–∫ **—á–∏—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç `ExecutionResult[]`**
* ‚ùè –Ω–∏ –æ–¥–∏–Ω —Ç–µ—Å—Ç –Ω–µ —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏

---

## 5. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è TestSpec

–î–∞–Ω–Ω—ã–π TestSpec:

* **–ù–ï —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç** –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `pnl`
* **–ù–ï —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç** —Ñ–æ—Ä–º–∞—Ç `message`
* **–ù–ï –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç** –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ–±—ã—Ç–∏–π
* **–ù–ï —Ä–∞—Å—à–∏—Ä—è–µ—Ç** CONTRACT_LEXICON

–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí **–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è TestSpec**.

---

## 6. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v0.1 ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä
* –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã:

  * —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
  * –ø–æ—Å–ª–µ Freeze FeedbackSource v1.0

---

## 7. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

> **–ú–æ–∂–Ω–æ –ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FeedbackSource
> –∫–∞–∫ —á–∏—Å—Ç—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç `ExecutionResult[]`
> –∏ –ø—Ä–æ–π—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã?**

* –î–∞ ‚Üí ‚úÖ TestSpec –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
* –ù–µ—Ç ‚Üí ‚ùå TestSpec –ø–æ–¥–ª–µ–∂–∏—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä—É

---

**END OF TEST SPEC ‚Äî FeedbackSource v0.1 (AUDIT-REVISED)**
