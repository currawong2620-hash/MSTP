# üü• TEST SPEC ‚Äî FeedbackSource v1.0

## **Event Aggregation & Determinism Acceptance Tests**

---

## 0. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Infrastructure / Feedback
**–¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è —Ä–æ–ª—å:** `FeedbackSource`
**–í–µ—Ä—Å–∏—è —Ä–æ–ª–∏:** v1.0
**–¢–∏–ø —Ç–µ—Å—Ç–æ–≤:** Acceptance / Contract Compliance
**–Ø–∑—ã–∫ —Ç–µ—Å—Ç–æ–≤:** **STRICT MQL5**

**–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤:**

```
tests/Infrastructure/TC_FeedbackSource_Tests.mqh
```

---

## 1. –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–¢–µ—Å—Ç—ã **–î–û–õ–ñ–ù–´ —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å**:

1. **SSP v1.1**
2. **CONTRACT_LEXICON v1.2**
3. **ARCHITECTURE_ROLE_MODEL v1.1**
4. **ARCHITECTURE_DATA_FLOW_MODEL v1.1**
5. **ROLE_CALL_CONTRACTS_MQL5 v0.1**
6. **TECH SPEC ‚Äî FeedbackSource v1.0**

–¢–µ—Å—Ç—ã **–ù–ï –ò–ú–ï–Æ–¢ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –≤–ª–∞—Å—Ç–∏**
–∏ **–ù–ï –ú–û–ì–£–¢ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É —Ä–æ–ª–∏**.

---

## 2. –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

Test Suite –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ `ExecutionResult[] ‚Üí Feedback`
* —Å—Ç—Ä–æ–≥–æ–≥–æ —Å–æ–±–ª—é–¥–µ–Ω–∏—è **Data Flow** (—Ç–æ–ª—å–∫–æ `ExecutionResult[]`)
* –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ `Feedback` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
* memory safety (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `ZeroMemory` –Ω–∞–¥ `Feedback`)
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## 3. –Ø–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã **–ù–ï –ø—Ä–æ–≤–µ—Ä—è—é—Ç**:

* —Ç–æ—Ä–≥–æ–≤—É—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
* —Ä—ã–Ω–æ—á–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é
* —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫—É—é —Å–µ–º–∞–Ω—Ç–∏–∫—É OPEN / CLOSE
* TP / SL
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `Decision`
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `Executor`
* –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ PnL

---

## 4. –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ö–†–ò–¢–ò–ß–ù–û)

### 4.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

* ‚ùå `ZeroMemory()` / `memset` –¥–ª—è `Feedback` ‚Äî **–ó–ê–ü–†–ï–©–ï–ù–û**
* –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º `Feedback` **–ù–ê–ú–ï–†–ï–ù–ù–û** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è ‚Äú–º—É—Å–æ—Ä–æ–º‚Äù
* –¶–µ–ª—å ‚Äî –¥–æ–∫–∞–∑–∞—Ç—å **–ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å** –≤—ã—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

### 4.2 –ò–∑–æ–ª—è—Ü–∏—è

* `Snapshot`, `Intent`, `PolicyAdjustedIntent`, `Decision`
  **–ù–ï —Å–æ–∑–¥–∞—é—Ç—Å—è** –∏ **–ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è**
* –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—Ö–æ–¥ ‚Äî `ExecutionResult[]`

---

### 4.3 –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ü–†–û–í–ï–†–Ø–Æ–¢–°–Ø –í –ö–ê–ñ–î–û–ú –¢–ï–°–¢–ï)

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç **–û–ë–Ø–ó–ê–ù** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

* `Feedback.event` ‚àà enum `feedback_event`
* `Feedback.pnl` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω (–≤ v1.0 –¥–æ–ø—É—Å—Ç–∏–º–æ `0.0`)
* `Feedback.message` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —è–≤–Ω–æ

---

## 5. –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö

–°—Ü–µ–Ω–∞—Ä–∏–∏ **FS-1** –∏ **FS-2** –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ö–æ–¥–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ
(`results_count == 0`), –Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç **—Ä–∞–∑–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã**:

* **FS-1** ‚Äî –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ (memory overwrite)
* **FS-2** ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é —Ç—Ä–∞–∫—Ç–æ–≤–∫—É –ø—É—Å—Ç–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–≠—Ç–æ **–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ** –∏ **–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ**.

---

## 6. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

---

### FS-1 ‚Äî –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å Feedback (Memory overwrite invariant)

**–¶–µ–ª—å:** –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è `Feedback` –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**Setup:**

```
Feedback.event   = POSITION_CLOSED
Feedback.pnl     = 999.99
Feedback.message = "JUNK"
```

**–í—Ö–æ–¥:**

```
results_count = 0
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event = ACTION_REJECTED`
* `Feedback.pnl = 0.0`
* `Feedback.message = "NO_EXECUTION"`

---

### FS-2 ‚Äî –ü—É—Å—Ç–æ–π –Ω–∞–±–æ—Ä ExecutionResult (Semantic invariant)

**–¶–µ–ª—å:** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í—Ö–æ–¥:**

```
results_count = 0
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event = ACTION_REJECTED`
* `Feedback.message = "NO_EXECUTION"`

---

### FS-3 ‚Äî –û–¥–∏–Ω EXECUTED —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–¶–µ–ª—å:** –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í—Ö–æ–¥:**

```
ExecutionResult[0].status = EXECUTED
results_count = 1
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event ‚àà feedback_event`
* `Feedback.event != ACTION_REJECTED`
* `Feedback.message != ""`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**

> Test does NOT assert OPEN vs CLOSE semantics.
> –õ—é–±–æ–µ —Å–æ–±—ã—Ç–∏–µ, –æ—Ç–ª–∏—á–Ω–æ–µ –æ—Ç `ACTION_REJECTED`,
> —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º —É—Å–ø–µ—à–Ω—ã–º –∏—Å—Ö–æ–¥–æ–º.

---

### FS-4 ‚Äî –°–º–µ—à–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (EXECUTED + FAILED)

**–¶–µ–ª—å:** –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–∞–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í—Ö–æ–¥:**

```
FAILED, EXECUTED
results_count = 2
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event != ACTION_REJECTED`
* `Feedback.message != ""`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
OPEN / CLOSE —Å–µ–º–∞–Ω—Ç–∏–∫–∞ **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è**.

---

### FS-5 ‚Äî –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã FAILED / REJECTED

**–¶–µ–ª—å:** –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–∂–Ω–æ–≥–æ ‚Äú—É—Å–ø–µ—Ö–∞‚Äù.

**–í—Ö–æ–¥:**

```
FAILED, REJECTED
results_count > 0
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* `Feedback.event = ACTION_REJECTED`

---

### FS-6 ‚Äî –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

**–¶–µ–ª—å:** –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—Ö–æ–¥ ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—ã—Ö–æ–¥.

**–í—Ö–æ–¥:**

* –¥–≤–∞ –≤—ã–∑–æ–≤–∞
* –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ `ExecutionResult[]`
* —Ä–∞–∑–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π –º—É—Å–æ—Ä –≤ `Feedback`

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* –æ–±–∞ `Feedback` –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–Ω—ã

---

### FS-7 ‚Äî –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞

**–¶–µ–ª—å:** –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–í—Ö–æ–¥:**

* –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –Ω–∞–±–æ—Ä `ExecutionResult.status`
* —Ä–∞–∑–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–û–∂–∏–¥–∞–Ω–∏–µ:**

* –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π `Feedback`

---

## 7. –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–¢–µ—Å—Ç—ã **–ù–ï –î–û–õ–ñ–ù–´**:

* –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `pnl` –∫—Ä–æ–º–µ —Ñ–∞–∫—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏
* —Ä–∞–∑–ª–∏—á–∞—Ç—å `POSITION_OPENED` vs `POSITION_CLOSED`
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä—ã–Ω–æ–∫, —Å–∏–º–≤–æ–ª, —Ç–∞–π–º—Ñ—Ä–µ–π–º
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MT5 trade API

---

## 8. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ Test Suite

Test Suite —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º, –µ—Å–ª–∏:

* –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ
* –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `ZeroMemory` –Ω–∞–¥ `Feedback`
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** `ExecutionResult[]`
* –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–æ–¥–∏–Ω –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç**
* –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã

---

## üîí –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è

* Test Spec **–ù–ï —Ä–∞—Å—à–∏—Ä—è–µ—Ç** —Ä–æ–ª—å FeedbackSource
* –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ FeedbackSource ‚Üí
  **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω–æ–π Test Spec**
* Test Spec –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ **acceptance baseline**

---

## üìå –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞

üü¢ **AUDIT-RESOLVED**
üü¢ **READY FOR BASELINE FIXATION**
üü¢ **READY FOR CODER-CHAT TASK**

-
