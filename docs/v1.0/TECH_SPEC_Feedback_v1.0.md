
# üü• TECH SPEC ‚Äî FeedbackSource v1.0

## **Event-based Feedback Aggregator**

---

## 0. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Infrastructure / Feedback
**–†–æ–ª—å:** `FeedbackSource`
**–í–µ—Ä—Å–∏—è —Ä–æ–ª–∏:** **v1.0**
**–¢–∏–ø:** Infrastructure role (non-replaceable)
**–Ø–∑—ã–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** **STRICT MQL5**

---

## 1. –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–î–û–õ–ñ–ù–ê —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å**:

1. **SSP v1.1**
2. **CONTRACT_LEXICON v1.2**
3. **ARCHITECTURE_ROLE_MODEL v1.1**
4. **ARCHITECTURE_DATA_FLOW_MODEL v1.1**
5. **ROLE_CALL_CONTRACTS_MQL5 v0.1**

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤, –ø–æ–ª–µ–π –∏–ª–∏ enum-–∑–Ω–∞—á–µ–Ω–∏–π,
**–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤ CONTRACT_LEXICON**, ‚Äî **–ó–ê–ü–†–ï–©–ï–ù–û**.

---

## 2. –†–æ–ª—å –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`FeedbackSource` ‚Äî —ç—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `Feedback`**
–Ω–∞ –æ—Å–Ω–æ–≤–µ **—Ñ–∞–∫—Ç–æ–≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è**, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç `Executor`.

–†–æ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç **–¢–û–õ–¨–ö–û** –Ω–∞ –≤–æ–ø—Ä–æ—Å:

> *¬´–ß—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ?¬ª*

---

## 3. –Ø–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–æ–ª–∏ (–ö–†–ò–¢–ò–ß–ù–û)

`FeedbackSource` **–ù–ï**:

* ‚ùå –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
* ‚ùå –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π
* ‚ùå –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫
* ‚ùå —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∏—Å–∫–æ–º
* ‚ùå —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏
* ‚ùå —á–∏—Ç–∞–µ—Ç `Snapshot`
* ‚ùå —á–∏—Ç–∞–µ—Ç `Intent`
* ‚ùå —á–∏—Ç–∞–µ—Ç `PolicyAdjustedIntent`
* ‚ùå —á–∏—Ç–∞–µ—Ç `Decision`
* ‚ùå –≤—ã–∑—ã–≤–∞–µ—Ç MT5 trade API

---

## 4. –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–æ–ª–∏ (–§–ò–ö–°–ò–†–û–í–ê–ù)

```mq5
void FeedbackSource_Run(
   const ExecutionResult &results[],
   const int results_count,
   Feedback &out_feedback
);
```

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏

* `results[]` ‚Äî **–¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** –æ—Ç `Executor`
* `results_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ `results[]`
* `out_feedback` ‚Äî **–ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** –∑–∞ –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª

---

## 5. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 5.1 ExecutionResult

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç `ExecutionResult` —Å–æ–¥–µ—Ä–∂–∏—Ç **–¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è**,
–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –≤ `CONTRACT_LEXICON v1.2`.

`FeedbackSource` **–ù–ï –î–û–õ–ñ–ï–ù**:

* –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `ExecutionResult`
* –¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫ –∏–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

---

## 6. –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî Feedback

`Feedback` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è **–†–û–í–ù–û –û–î–ò–ù –†–ê–ó –∑–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª**.

---

### 6.1 Feedback.event (–ù–û–†–ú–ê–¢–ò–í–ù–û)

`Feedback.event` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û** –∑–Ω–∞—á–µ–Ω–∏—è,
–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –≤ enum `feedback_event`
–≤ **CONTRACT_LEXICON v1.2**.

`FeedbackSource` **–ù–ï –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –∏ **–ù–ï —Ä–∞—Å—à–∏—Ä—è–µ—Ç**
–ø–µ—Ä–µ—á–µ–Ω—å –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

–¢–∏–ø —Å–æ–±—ã—Ç–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏,
–¥–æ—Å—Ç—É–ø–Ω–æ–π –≤ `ExecutionResult[]`.

`FeedbackSource` **–ù–ï –ò–ú–ï–ï–¢ –¥–æ—Å—Ç—É–ø–∞**
–∫ `Decision`, `Intent`, `PolicyAdjustedIntent` –∏–ª–∏ `Snapshot`.

–ï—Å–ª–∏ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
–Ω–∞ –æ—Å–Ω–æ–≤–µ `ExecutionResult[]`,
–¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–æ–±–æ–±—â—ë–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è**.

---

### 6.2 Feedback.pnl (v1.0)

* –í –≤–µ—Ä—Å–∏–∏ v1.0 `Feedback.pnl` **–ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã**
* –ú–æ–∂–µ—Ç –±—ã—Ç—å:

  * `0.0`
  * –ª–∏–±–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–∞–∫—Ç–æ–º –∏–∑ `ExecutionResult`, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
* `FeedbackSource` **–ù–ï –û–ë–Ø–ó–ê–ù** –≤—ã—á–∏—Å–ª—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π PnL

---

### 6.3 Feedback.message

* –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–µ
* –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:

  * `"EXECUTED"`
  * `"PARTIAL"`
  * `"FAILED"`
  * `"REJECTED"`
  * `"NO_EXECUTION"`
* **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ä–æ–ª—è–º–∏**

---

## 7. –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (–ù–û–†–ú–ê–¢–ò–í–ù–´–ô)

```text
1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å out_feedback
   (–±–µ–∑ ZeroMemory, —Å —è–≤–Ω—ã–º–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è–º–∏).

2. –ï—Å–ª–∏ results_count == 0:
     event   = ACTION_REJECTED
     message = "NO_EXECUTION"
     pnl     = 0.0
     RETURN

3. –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å results[]:
     –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ EXECUTED / PARTIAL

4. –ï—Å–ª–∏ –µ—Å—Ç—å EXECUTED –∏–ª–∏ PARTIAL:
     event = –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (–∏–∑ enum feedback_event)
   –ò–Ω–∞—á–µ:
     event = ACTION_REJECTED

5. pnl = 0.0 (v1.0)
6. message = –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ–∫–∞
```

---

## 8. Memory Safety (–ö–†–ò–¢–ò–ß–ù–û)

### 8.1 –ó–∞–ø—Ä–µ—â–µ–Ω–æ

* ‚ùå `ZeroMemory(out_feedback)`
* ‚ùå `memset`
* ‚ùå –ø–æ–±–∏—Ç–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö `string`

### 8.2 –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

```mq5
out_feedback.event   = ACTION_REJECTED;
out_feedback.pnl     = 0.0;
out_feedback.message = "";
```

---

## 9. –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

`FeedbackSource` **–î–û–õ–ñ–ï–ù –±—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º**:

* –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `results[]` ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `Feedback`
* –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ `results[]` **–ù–ï –≤–ª–∏—è–µ—Ç**
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

## 10. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Coordinator

* `Coordinator` –≤—ã–∑—ã–≤–∞–µ—Ç `FeedbackSource_Run()`
  **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª**
* –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `Feedback`:

  * –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è Runner‚Äô—É (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
  * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –≤—Ö–æ–¥ `feedback_in` —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
* `Coordinator` **–ù–ï –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç** `Feedback`

---

## 11. –Ø–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ v1.0

FeedbackSource v1.0:

* ‚ùå –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç TP / SL
* ‚ùå –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç OPEN / CLOSE –ø–æ —Å–º—ã—Å–ª—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
* ‚ùå –Ω–µ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç PnL –ø–æ —Å–¥–µ–ª–∫–∞–º
* ‚ùå –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é
* ‚ùå –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

–≠—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è **–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã** –∏ **–Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –¥–µ—Ñ–µ–∫—Ç–∞–º–∏**.

---

## 12. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –µ—Å–ª–∏:

* ‚úî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `Feedback`
* ‚úî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ZeroMemory`
* ‚úî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª
* ‚úî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `results_count == 0`
* ‚úî —á–∏—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** `ExecutionResult[]`
* ‚úî –Ω–µ –∏–º–µ–µ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

---

## üîí –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è

* `FeedbackSource v1.0` ‚Äî **–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ñ–∞–∫—Ç–æ–≤**
* –ù–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π, —Ä–∏—Å–∫–æ–º –∏–ª–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
* –õ—é–±–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí **–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (v1.1+)**

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
üü¢ **AUDIT-RESOLVED ‚Äî READY FOR BASELINE FIXATION**

---
