# üü• TECH SPEC ‚Äî RiskArbiter v1.0

## **ReferenceTrendBreak (Baseline Gate)**

### **REV B (AUDIT-RESOLVED)**

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform (MQL5)
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Strategy / Replaceable Roles
**–†–æ–ª—å:** `RiskArbiter`
**–í–µ—Ä—Å–∏—è:** **v1.0**
**–†–µ–≤–∏–∑–∏—è:** **REV B**
**–°—Ç–∞—Ç—É—Å:** Reference / Baseline
**–Ø–∑—ã–∫:** —Å—Ç—Ä–æ–≥–æ MQL5

**–§–∞–π–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```
modules/Strategy/RiskArbiter.mqh
```

---

## 1. –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–î–û–õ–ñ–ù–ê —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å**:

1. **SSP v1.0**
2. **CONTRACT_LEXICON v1.1**
3. **NAMING_RULES v1.0**
4. **ROLE_CALL_CONTRACTS_MQL5 v0.1**
5. **STRATEGY_SPEC ‚Äî ReferenceTrendBreak v1.0**
6. **ROADMAP ‚Äî ReferenceTrendBreak v1.0**

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:

* –≤–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–∏–ø—ã
* –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è –∏–ª–∏ enum
* –∏–∑–º–µ–Ω—è—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∏–ø–æ–≤
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Decision.status = MODIFY`

---

## 2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ (–ù–û–†–ú–ê–¢–ò–í–ù–û)

`RiskArbiter v1.0` —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏**
–¥–ª—è baseline-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ `ReferenceTrendBreak`.

–†–æ–ª—å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ **–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û** –¥–ª—è:

> –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ `PolicyAdjustedIntent`
> –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏–º–æ–≥–æ `Decision`.

`RiskArbiter v1.0` **–ù–ï**:

* —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∏—Å–∫–æ–º
* –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä—ë–º—ã
* –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è
* –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫
* —Ä–µ–∞–ª–∏–∑—É–µ—Ç exit-policy
* —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

## 3. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 3.1 `PolicyAdjustedIntent policy_intent`

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–¢–û–õ–¨–ö–û –ø–æ–ª—è**:

* `policy_intent.type`
* `policy_intent.direction`
* `policy_intent.volume`

–ü–æ–ª–µ:

* `policy_intent.tag`

  * ‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏–∫–∏**
  * ‚ùå **–ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ**
  * –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è **–¢–û–õ–¨–ö–û –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ / —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏**

---

### 3.2 `Snapshot snapshot`

`Snapshot` —á–∏—Ç–∞–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** –¥–ª—è:

* `snapshot.market.symbol`

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:

* —á–∏—Ç–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–ª—è `Snapshot`
* –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∏–ª–∏ –±–∞—Ä—ã

---

## 4. –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4.1 `Decision out_decision`

–ù–∞ –∫–∞–∂–¥—ã–π –≤—Ö–æ–¥–Ω–æ–π `PolicyAdjustedIntent`
—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è **–†–û–í–ù–û –û–î–ò–ù** `Decision`.

–í—ã—Ö–æ–¥–Ω–æ–π `Decision` **–û–ë–Ø–ó–ê–ù** –±—ã—Ç—å:

* –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∞–ª–∏–¥–Ω—ã–º –ø–æ CONTRACT_LEXICON
* —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –¥–ª—è Executor
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º

---

## 5. –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ä–µ—à–µ–Ω–∏—è (–ñ–Å–°–¢–ö–û)

–í –≤–µ—Ä—Å–∏–∏ **v1.0** –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è **–¢–û–õ–¨–ö–û**:

* `Decision.status = ACCEPT`
* `Decision.status = REJECT`

‚ùå `MODIFY` ‚Äî **–ó–ê–ü–†–ï–©–Å–ù**.

---

## 6. –ü—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è Decision (–ù–û–†–ú–ê–¢–ò–í–ù–û)

### 6.1 –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

```
–í–∞–ª–∏–¥–Ω—ã–π PolicyAdjustedIntent
‚Üí ACCEPT
–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π PolicyAdjustedIntent
‚Üí REJECT
```

---

### 6.2 ACCEPT ‚Äî —É—Å–ª–æ–≤–∏—è –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π

`Decision.status = ACCEPT`, –µ—Å–ª–∏ **–û–î–ù–û–í–†–ï–ú–ï–ù–ù–û** –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:

* `policy_intent.type ‚àà { WANT_OPEN, WANT_CLOSE }`
* `policy_intent.volume > 0`
* `policy_intent.direction ‚àà { +1, -1 }`

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ `RiskArbiter` **–û–ë–Ø–ó–ê–ù –∑–∞–ø–æ–ª–Ω–∏—Ç—å**:

* `Decision.status = ACCEPT`
* `Decision.action`:

  * `OPEN` ‚Äî –µ—Å–ª–∏ `policy_intent.type == WANT_OPEN`
  * `CLOSE` ‚Äî –µ—Å–ª–∏ `policy_intent.type == WANT_CLOSE`
* `Decision.direction = policy_intent.direction`
* `Decision.volume = policy_intent.volume`
* `Decision.symbol = snapshot.market.symbol`
* `Decision.reason = "OK"`

---

### 6.3 REJECT ‚Äî —É—Å–ª–æ–≤–∏—è –∏ –ø—Ä–∏—á–∏–Ω—ã

`Decision.status = REJECT`, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–õ–Æ–ë–û–ï** –∏–∑ —É—Å–ª–æ–≤–∏–π:

* `policy_intent.type` –Ω–µ —Ä–∞–≤–µ–Ω `WANT_OPEN` –∏ –Ω–µ —Ä–∞–≤–µ–Ω `WANT_CLOSE`
* `policy_intent.volume <= 0`
* `policy_intent.direction == 0`

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:

* `Decision.status = REJECT`
* –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è **–ù–ï –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è**
* `Decision.reason` **–û–ë–Ø–ó–ê–ù** –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑:

  * `"INVALID_INTENT"`
  * `"INVALID_VOLUME"`
  * `"INVALID_DIRECTION"`

---

## 7. –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è `Decision.reason` (–ù–û–†–ú–ê–¢–ò–í–ù–û)

–í –≤–µ—Ä—Å–∏–∏ v1.0 `Decision.reason` ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–æ–¥,
–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π **–¢–û–õ–¨–ö–û** –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

–î–æ–ø—É—Å—Ç–∏–º—ã **–¢–û–õ–¨–ö–û** –∑–Ω–∞—á–µ–Ω–∏—è:

* `"OK"`
* `"INVALID_INTENT"`
* `"INVALID_VOLUME"`
* `"INVALID_DIRECTION"`

‚ùå –õ—é–±—ã–µ –∏–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

---

## 8. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–ø—Ä–µ—Ç—ã (–ö–†–ò–¢–ò–ß–ù–û)

`RiskArbiter v1.0` **–ù–ï –ò–ú–ï–ï–¢ –ü–†–ê–í–ê**:

‚ùå –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `policy_intent.tag` –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—é—â—É—é –ª–æ–≥–∏–∫—É
‚ùå –∏–∑–º–µ–Ω—è—Ç—å `volume`
‚ùå –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MODIFY`
‚ùå —á–∏—Ç–∞—Ç—å —Ä—ã–Ω–æ–∫, –∫—Ä–æ–º–µ `snapshot.market.symbol`
‚ùå –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–∑–∏—Ü–∏–∏
‚ùå –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã `PositionPolicyManager`
‚ùå —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
‚ùå —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –≤—ã—Ö–æ–¥–∞ (SL / TP / policy)

---

## 9. –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

–ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–∞—Ö:

* `PolicyAdjustedIntent`
* `Snapshot.market.symbol`

`RiskArbiter_Run()` **–î–û–õ–ñ–ï–ù** –≤—ã–¥–∞–≤–∞—Ç—å:

* –±–∏—Ç-–≤-–±–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `Decision`
* –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏, –∏—Å—Ç–æ—Ä–∏–∏, —Ç–∏–∫–æ–≤

---

## 10. –í–∏–∑—É–∞–ª—å–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

`RiskArbiter v1.0` **–û–ë–Ø–ó–ê–ù** –±—ã—Ç—å –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º —á–µ—Ä–µ–∑:

```
VisualTester_RiskArbiter
```

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è **–¢–û–õ–¨–ö–û**:

* –≤—Ö–æ–¥–Ω–æ–π `PolicyAdjustedIntent`
* –≤—ã—Ö–æ–¥–Ω–æ–π `Decision`

–ï—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –Ω–µ –æ–±—ä—è—Å–Ω–∏–º–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ ‚Äî
—ç—Ç–æ **–¥–µ—Ñ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**, –∞ –Ω–µ —Ç–µ—Å—Ç–µ—Ä–∞.

---

## 11. –ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏ (v1.0)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –µ—Å–ª–∏:

* `WANT_OPEN (+1/-1)` ‚Üí `Decision(ACCEPT, OPEN)`
* `WANT_CLOSE (+1/-1)` ‚Üí `Decision(ACCEPT, CLOSE)`
* `direction == 0` ‚Üí `REJECT`
* `volume <= 0` ‚Üí `REJECT`
* `Decision.symbol` –∑–∞–ø–æ–ª–Ω–µ–Ω **–Ω–∞ –≤—ã—Ö–æ–¥–µ —Ä–æ–ª–∏**
* `MODIFY` –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
* Executor –ø–æ–ª—É—á–∞–µ—Ç **—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π Decision**
* –Ω–∏ –æ–¥–∏–Ω –ø—É–Ω–∫—Ç SSP / Lexicon –Ω–µ –Ω–∞—Ä—É—à–µ–Ω

---

## 12. –°—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏

* `RiskArbiter v1.0 (REV B)` ‚Äî **BASELINE**
* –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã
* —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–ª–∏–º–∏—Ç—ã, –¥–Ω–µ–≤–Ω–æ–π —Ä–∏—Å–∫, exposure –∏ —Ç.–¥.) ‚Äî
  **–¢–û–õ–¨–ö–û –≤ v1.1+** —Å –Ω–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

---

## 13. –ò—Ç–æ–≥–æ–≤–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

> **RiskArbiter v1.0 ‚Äî —ç—Ç–æ –Ω–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –Ω–µ —Ä–∏—Å–∫-–º–æ–¥–µ–ª—å.
> –≠—Ç–æ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ —Å—Ç—Ä–æ–≥–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ç—É—Ä–Ω–∏–∫–µ—Ç.**

–ï—Å–ª–∏ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ‚Äú—É–º–Ω–µ–µ‚Äù ‚Äî
–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∂–µ –Ω–∞—Ä—É—à–µ–Ω–∞.
