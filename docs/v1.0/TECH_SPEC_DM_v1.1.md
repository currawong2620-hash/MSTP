# üü• TECH SPEC ‚Äî DecisionMaker v1.1

## ReferenceTrendBreak (Directional Intent)

**–ü—Ä–æ–µ–∫—Ç:** Trading Platform (MQL5)
**–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞:** Strategy / Replaceable Roles
**–†–æ–ª—å:** `DecisionMaker`
**–í–µ—Ä—Å–∏—è —Ä–æ–ª–∏:** **v1.1**
**–°—Ç–∞—Ç—É—Å:** Reference / Baseline
**–Ø–∑—ã–∫:** **—Å—Ç—Ä–æ–≥–æ MQL5**

**–§–∞–π–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```
modules/Strategy/DecisionMaker.mqh
```

---

## 1. –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–î–û–õ–ñ–ù–ê —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å**:

1. **SSP v1.x**
2. **ARCHITECTURE_ROLE_MODEL v1.1**
3. **ARCHITECTURE_DATA_FLOW_MODEL v1.1**
4. **CONTRACT_LEXICON v1.2**
5. **ROLE_CALL_CONTRACTS_MQL5 v0.1**
6. **NAMING_RULES v1.0**
7. **STRATEGY_SPEC ‚Äî ReferenceTrendBreak v1.1**

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:

* –≤–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–∏–ø—ã
* –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è –∏–ª–∏ enum
* —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫ –Ω–∞–ø—Ä—è–º—É—é (bid/ask –∏ —Ç.–ø.)

---

## 2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏

`DecisionMaker v1.1` —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é Intent**
–¥–ª—è **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏** LONG/SHORT –ø–∞–π–ø–ª–∞–π–Ω–∞.

–†–æ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç **–¢–û–õ–¨–ö–û** –Ω–∞ –≤–æ–ø—Ä–æ—Å:

> *¬´–•–æ—á—É –ª–∏ —è –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å–µ–π—á–∞—Å, –∏ –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏?¬ª*

–†–æ–ª—å **–ù–ï**:

* —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∏—Å–∫–æ–º
* —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã—Ö–æ–¥–æ–º
* –∑–Ω–∞–µ—Ç –ø—Ä–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
* –∑–Ω–∞–µ—Ç –ø—Ä–æ SL/TP
* –∑–Ω–∞–µ—Ç –ø—Ä–æ PnL

---

## 3. –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–æ–ª–∏ (–ó–ê–ö–†–ï–ü–õ–Å–ù, –ù–ï –ú–ï–ù–Ø–¢–¨)

```mq5
void DecisionMaker_Run(
   const Snapshot &snapshot,
   const Feedback &feedback,
   Intent &out_intent
);
```

---

## 4. –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Snapshot (–ñ–Å–°–¢–ö–û)

`DecisionMaker v1.1` **–ú–û–ñ–ï–¢ —á–∏—Ç–∞—Ç—å –¢–û–õ–¨–ö–û**:

```text
snapshot.time.is_new_bar
snapshot.position.has_position
snapshot.market.last_closes[3]
```

‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ —á–∏—Ç–∞—Ç—å:

* –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è `Snapshot.market`
* `Snapshot.position.*` –∫—Ä–æ–º–µ `has_position`
* `Snapshot.time.*` –∫—Ä–æ–º–µ `is_new_bar`
* `Feedback` (—Å–º. ¬ß8)

---

## 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `last_closes` (–ù–û–†–ú–ê–¢–ò–í–ù–û)

`last_closes`:

* –¥–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞ **—Å—Ç—Ä–æ–≥–æ = 3**
* —Å–æ–¥–µ—Ä–∂–∏—Ç **–¢–û–õ–¨–ö–û –∑–∞–∫—Ä—ã—Ç—ã–µ –±–∞—Ä—ã**
* –ø–æ—Ä—è–¥–æ–∫:

  * `last_closes[0]` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫—Ä—ã—Ç—ã–π –±–∞—Ä
  * `last_closes[1]` ‚Äî –ø—Ä–µ–¥—ã–¥—É—â–∏–π
  * `last_closes[2]` ‚Äî –µ—â—ë –ø—Ä–µ–¥—ã–¥—É—â–∏–π

`DecisionMaker`:

* **–¢–û–õ–¨–ö–û —á–∏—Ç–∞–µ—Ç** –º–∞—Å—Å–∏–≤
* **–ù–ï –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç** –µ–≥–æ –∫–∞–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
* **–ù–ï –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç**
* **–ù–ï —Ä–∞—Å—à–∏—Ä—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é**

---

## 6. –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è Intent (–ù–û–†–ú–ê–¢–ò–í–ù–´–ô)

### 6.1 –ë–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è

–ê–ª–≥–æ—Ä–∏—Ç–º **–ê–ö–¢–ò–í–ï–ù –¢–û–õ–¨–ö–û –ï–°–õ–ò**:

```text
snapshot.time.is_new_bar == true
AND snapshot.position.has_position == false
```

–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí `NO_ACTION`.

---

### 6.2 –£—Å–ª–æ–≤–∏–µ LONG

```text
IF last_closes[0] > last_closes[1]
AND last_closes[1] > last_closes[2]
```

‚Üí

```mq5
out_intent.type       = WANT_OPEN;
out_intent.direction  = +1;
out_intent.confidence = 1.0;
```

---

### 6.3 –£—Å–ª–æ–≤–∏–µ SHORT

```text
IF last_closes[0] < last_closes[1]
AND last_closes[1] < last_closes[2]
```

‚Üí

```mq5
out_intent.type       = WANT_OPEN;
out_intent.direction  = -1;
out_intent.confidence = 1.0;
```

---

### 6.4 –ò–Ω–∞—á–µ

–í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö:

```mq5
out_intent.type       = NO_ACTION;
out_intent.direction  = 0;
out_intent.confidence = 0.0;
```

---

## 7. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ö–†–ò–¢–ò–ß–ù–û)

`DecisionMaker v1.1` **–û–ë–Ø–ó–ê–ù**:

1. –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å **–†–û–í–ù–û –û–î–ò–ù** `Intent`
2. –ë—ã—Ç—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º**
3. –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
4. **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `WANT_CLOSE`
5. **–ù–ò–ö–û–ì–î–ê** –Ω–µ —á–∏—Ç–∞—Ç—å —Ä—ã–Ω–æ–∫ –Ω–∞–ø—Ä—è–º—É—é
6. –†–∞–±–æ—Ç–∞—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ –¥–ª—è LONG –∏ SHORT
7. –ù–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## 8. Feedback (–Ø–í–ù–´–ô –ó–ê–ü–†–ï–¢)

`feedback`:

* –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç **–¢–û–õ–¨–ö–û –¥–ª—è —Å–∏–≥–Ω–∞—Ç—É—Ä–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**
* **–ù–ï –ß–ò–¢–ê–ï–¢–°–Ø**
* **–ù–ï –í–õ–ò–Ø–ï–¢** –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ

---

## 9. –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

–î–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–æ–≤:

```text
Snapshot
Feedback
```

`DecisionMaker_Run()` **–û–ë–Ø–ó–ê–ù** –≤—ã–¥–∞–≤–∞—Ç—å:

* –±–∏—Ç-–≤-–±–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `Intent`
* –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏, –∏—Å—Ç–æ—Ä–∏–∏, —Ç–∏–∫–æ–≤

---

## 10. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–ø—Ä–µ—Ç—ã (–ñ–Å–°–¢–ö–û)

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:

* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SymbolInfo*`, `MarketInfo`
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MT5 —Ç–æ—Ä–≥–æ–≤—ã–π API
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `static` mutable variables
* —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `WANT_CLOSE`
* –∏–∑–º–µ–Ω—è—Ç—å `confidence` –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

---

## 11. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–î–û–õ–ñ–ù–ê –ø—Ä–æ–π—Ç–∏**:

```
TEST SPEC ‚Äî DecisionMaker ReferenceTrendBreak v1.1
```

(–±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º)

---

## 12. –°—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏

**DecisionMaker v1.1 (ReferenceTrendBreak, Directional)**

* baseline
* –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã
* —Ä–∞–∑–≤–∏—Ç–∏–µ ‚Äî **–¢–û–õ–¨–ö–û v1.2+**
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

  * –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —ç—Ç–∞–ª–æ–Ω
  * –∫–∞–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —è–∫–æ—Ä—å
  * –∫–∞–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è LONG/SHORT –ø–∞–π–ø–ª–∞–π–Ω–∞

---

## üîí –§–∏–∫—Å–∞—Ü–∏—è Master-Chat

–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞:

* `last_closes[3]` ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äú–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏‚Äù**
* DecisionMaker –æ—Å—Ç–∞—ë—Ç—Å—è **–Ω–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π**
* –õ—é–±–æ–µ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ ‚Üí **–ù–û–í–ê–Ø –≤–µ—Ä—Å–∏—è**

---

