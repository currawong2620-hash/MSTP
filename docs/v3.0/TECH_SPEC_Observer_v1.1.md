# üü• TECH SPEC ‚Äî Observer **v1.1**

## Multi-Timeframe Snapshot Producer

**Status:** DRAFT ‚Üí READY FOR AUDIT
**Role:** `Observer`
**Stage:** Infrastructure
**Language:** STRICT MQL5
**Supersedes:** Observer v1.0
**Authority:** SSP v3.0, CONTRACT_LEXICON v3.0

---

## 0. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`Observer v1.1` ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è:

* —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç **–µ–¥–∏–Ω—ã–π `Snapshot`** –∑–∞ —Ü–∏–∫–ª,
* **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π producer** –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π Snapshot,
* **–¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É multi-timeframe —Ç—Ä–µ–Ω–¥–æ–≤** —á–µ—Ä–µ–∑ `Snapshot.trends`,
* –æ—Å—Ç–∞—ë—Ç—Å—è **stateless**, **deterministic**, **snapshot-only**.

---

## 1. –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–î–û–õ–ñ–ù–ê** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:

* SSP v3.0
* CONTRACT_LEXICON v3.0
* ARCHITECTURE_DATA_FLOW_MODEL v1.1
* ROLE_CALL_CONTRACTS_MQL5 v0.1
* NAMING_RULES v1.0

---

## 2. –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–æ–ª–∏ (FIXED)

```mq5
void Observer_Run(
    Snapshot &out_snapshot
);
```

### –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

* `out_snapshot` **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è**
* –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **–Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è –∏ –Ω–µ –ø–∏—à–µ—Ç—Å—è**
* –≤–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
* MT5 API **—Ä–∞–∑—Ä–µ—à—ë–Ω** (Observer ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

---

## 3. Input Configuration (Startup, Immutable)

### 3.1 Multi-TF —Å–ø–∏—Å–æ–∫

```mq5
input string OBS_TF_LIST = "M5,M15,H1";
```

#### –°–µ–º–∞–Ω—Ç–∏–∫–∞

* —Å—Ç—Ä–æ–∫–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö `,`
* –ø—Ä–æ–±–µ–ª—ã –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
* –ø–æ—Ä—è–¥–æ–∫ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**
* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ TF ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ (`>=1`)

---

## 4. –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ (Normative)

### 4.1 –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã

* `M1..M59`
* `H1..H12`
* `D1`
* `W1`
* `MN1`

(—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç `ENUM_TIMEFRAMES` MT5)

### 4.2 –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞

–ü–∞—Ä—Å–µ—Ä **–û–ë–Ø–ó–ê–ù**:

* –≤–µ—Ä–Ω—É—Ç—å **—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ `timeframe[]`**
* –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `count`
* –ø—Ä–∏ –æ—à–∏–±–∫–µ:

  * **fail-fast** ‚Üí `count = 0`
  * `Snapshot.trends.count = 0`
  * –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ Snapshot **–≤—Å—ë —Ä–∞–≤–Ω–æ –≤–∞–ª–∏–¥–Ω—ã**

> Observer **–ù–ï –ò–ú–ï–ï–¢ –ü–†–ê–í–ê** –ø–∞–¥–∞—Ç—å –∏–ª–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

---

## 5. Snapshot Population Rules

### 5.1 Snapshot.market / position / time / constraints

–ó–∞–ø–æ–ª–Ω—è—é—Ç—Å—è **–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Observer v1.0**
(–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏–∫–∏ –∏ —Å–µ–º–∞–Ω—Ç–∏–∫–∏).

---

### 5.2 Snapshot.trends (NEW)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Å—Ç—Ä–æ–≥–æ –ø–æ Lexicon)

```
Snapshot.trends
‚îú‚îÄ‚îÄ count
‚îî‚îÄ‚îÄ items[0..count-1] : TrendInfo
```

#### Ownership

* **SOLE PRODUCER:** Observer
* downstream ‚Äî read-only / no-access (–ø–æ SSP)

---

## 6. TrendInfo computation (v1.1 ‚Äî MINIMAL)

### 6.1 –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

Observer **–í–´–ß–ò–°–õ–Ø–ï–¢ –¢–û–õ–¨–ö–û –§–ê–ö–¢**, –∞ –Ω–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

TrendInfo **–ù–ï —è–≤–ª—è–µ—Ç—Å—è —Å–∏–≥–Ω–∞–ª–æ–º**.

---

### 6.2 TrendInfo fields

–î–ª—è –∫–∞–∂–¥–æ–≥–æ TF:

* `timeframe` ‚Äî –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞
* `regime`
* `direction`
* `confidence`

---

### 6.3 –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å (v1.1)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ TF Observer:

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç **–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –±–∞—Ä—ã** TF
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π lookback = 3 –∑–∞–∫—Ä—ã—Ç—ã—Ö –±–∞—Ä–∞**
3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç:

#### direction

* `+1` –µ—Å–ª–∏ `close[2] > close[1] > close[0]`
* `-1` –µ—Å–ª–∏ `close[2] < close[1] < close[0]`
* `0` –∏–Ω–∞—á–µ

#### regime

* `TREND` –µ—Å–ª–∏ `direction != 0`
* `RANGE` –µ—Å–ª–∏ `direction == 0`

#### confidence

* `1.0` –µ—Å–ª–∏ —Å—Ç—Ä–æ–≥–∏–π –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
* `0.5` –µ—Å–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä 2 –∏–∑ 3)
* `0.0` –µ—Å–ª–∏ `direction == 0`

> –≠—Ç–æ **baseline-–º–æ–¥–µ–ª—å**, –Ω–µ alpha, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è:
>
> * —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã,
> * –æ—Ç–ª–∞–¥–∫–∏ multi-TF,
> * –∑–∞–º–µ–Ω—ã –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.

---

## 7. –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (IMPORTANT)

* –í—Å–µ TF –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è **–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ Observer**
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –±–∞—Ä—ã –∫–∞–∂–¥–æ–≥–æ TF**
* –í—Ä–µ–º—è –≤ `Snapshot.time.timestamp` ‚Äî **–≤—Ä–µ–º—è —Ü–∏–∫–ª–∞**, –∞ –Ω–µ TF

---

## 8. Determinism & Statelessness

Observer v1.1 **–ì–ê–†–ê–ù–¢–ò–†–£–ï–¢**:

* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
* –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π Snapshot –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Å—Ç–æ—Ç—ã —Ç–∏–∫–æ–≤

---

## 9. –ó–∞–ø—Ä–µ—Ç—ã (CRITICAL)

Observer v1.1 **–ù–ï –ò–ú–ï–ï–¢ –ü–†–ê–í–ê**:

‚ùå —á–∏—Ç–∞—Ç—å `Feedback`
‚ùå —á–∏—Ç–∞—Ç—å `Intent`
‚ùå –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
‚ùå —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã
‚ùå –ø–∏—Å–∞—Ç—å –≤ `Snapshot` –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
‚ùå –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `(void)`
‚ùå –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `#pragma once`

---

## 10. Backward Compatibility

* –ü—Ä–∏ `OBS_TF_LIST` –∏–∑ –æ–¥–Ω–æ–≥–æ TF:

  * –ø–æ–≤–µ–¥–µ–Ω–∏–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ Observer v1.0
* –ü—Ä–∏ –ø—É—Å—Ç–æ–º / –æ—à–∏–±–æ—á–Ω–æ–º —Å–ø–∏—Å–∫–µ:

  * `Snapshot.trends.count = 0`
  * Snapshot **–≤–∞–ª–∏–¥–µ–Ω**

---

## 11. Visual Observability (MANDATORY)

Observer **–û–ë–Ø–ó–ê–ù** –∏–º–µ—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä:

### Market Snapshot Viewer v1.1

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:

* –æ—Å–Ω–æ–≤–Ω–æ–π TF (`Snapshot.market.tf`)
* —Ç–µ–∫—É—â–∏–µ OHLC / bid / ask
* **—Ç–∞–±–ª–∏—Ü—É `Snapshot.trends`**:

  * TF
  * regime
  * direction
  * confidence

Read-only. –ë–µ–∑ –ª–æ–≥–∏–∫–∏.

---

## 12. –°—Ç–∞—Ç—É—Å

* ‚ùå –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
* ‚ùå –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
* ‚úÖ **–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω**
* ‚ñ∂Ô∏è –≥–æ—Ç–æ–≤ –∫:

  * Test Spec
  * Coder-Chat implementation task

---

**END OF TECH SPEC ‚Äî Observer v1.1**

