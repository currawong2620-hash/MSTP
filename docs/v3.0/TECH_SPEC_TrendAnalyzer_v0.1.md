# üü• TECH SPEC

## TrendAnalyzer v0.1 ‚Äî Indicator-Based Trend Analysis (Normative)

**Component:** TrendAnalyzer
**Layer:** Strategy / Analytical
**Stage:** Pre-Decision
**Language:** STRICT MQL5
**Status:** READY FOR ACCEPTANCE
**Authority:** Master-Chat
**Audit status:** ACCEPTABLE (no blockers)

---

## 0. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`TrendAnalyzer` ‚Äî **—á–∏—Å—Ç—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å**, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è:

> **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
> –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∞–π–º—Ñ—Ä–µ–π–º—É –æ—Ç–¥–µ–ª—å–Ω–æ
> –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
> —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤.**

–ú–æ–¥—É–ª—å **–Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π** –∏ **–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏**.

---

## 1. –ì—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (–∂—ë—Å—Ç–∫–æ)

### TrendAnalyzer –ú–û–ñ–ï–¢

* —á–∏—Ç–∞—Ç—å market history
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã MT5
* –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å **–æ–¥–∏–Ω —Ç–∞–π–º—Ñ—Ä–µ–π–º –∑–∞ –≤—ã–∑–æ–≤**
* –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

### TrendAnalyzer –ù–ï –ú–û–ñ–ï–¢

* —Ç–æ—Ä–≥–æ–≤–∞—Ç—å
* –≤—ã–∑—ã–≤–∞—Ç—å trade API
* —á–∏—Ç–∞—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `Snapshot`
* –∑–Ω–∞—Ç—å –æ –ø–æ–∑–∏—Ü–∏—è—Ö
* –ø—Ä–∏–Ω–∏–º–∞—Ç—å `Decision`
* –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã
* —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å

```
TrendAnalyzer ‚Äî pure analytical strategy component,
invoked by Coordinator or higher-level strategy logic
once per timeframe.
```

### –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ

```
Market Data
   ‚Üì
TrendAnalyzer (per timeframe, analytical only)
   ‚Üì
(Visualisation / Strategy logic / future DecisionMaker)
```

* TrendAnalyzer **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å—é SSP**
* TrendAnalyzer **–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Observer**
* TrendAnalyzer **–Ω–µ –ø–∏—à–µ—Ç Snapshot**

---

## 3. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### 3.1 –í—Ö–æ–¥ (Input Contract)

TrendAnalyzer v0.1 –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–æ–¥–∏–Ω —Ç–∞–π–º—Ñ—Ä–µ–π–º –∑–∞ –≤—ã–∑–æ–≤**.

```text
Input:
  symbol      : string
  timeframe   : ENUM_TIMEFRAMES
```

–ò—Å—Ç–æ—á–Ω–∏–∫ –≤—Ö–æ–¥–∞:

* Coordinator
* Strategy runner
* —Ç–µ—Å—Ç–æ–≤—ã–π harness

‚ùå –Ω–µ Snapshot
‚ùå –Ω–µ Observer

---

### 3.2 –í—ã—Ö–æ–¥ (Output Contract)

```text
Output:
  TrendAnalysisResult
```

#### TrendAnalysisResult

| –ü–æ–ª–µ       | –¢–∏–ø                  | –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è     |
| ---------- | -------------------- | ----------------------- |
| timeframe  | ENUM_TIMEFRAMES      | –≤—Ö–æ–¥–Ω–æ–π TF              |
| regime     | enum                 | TREND / RANGE / UNKNOWN |
| direction  | direction-compatible | ‚àí1 / 0 / +1             |
| confidence | double               | [0.0 ‚Ä¶ 1.0]             |

---

## 4. –°–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–æ–ª—è `direction` (Lexicon-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

–ü–æ–ª–µ `direction` –≤ `TrendAnalysisResult`:

* **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å `CONTRACT_LEXICON.direction`**
* –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `‚àí1 / 0 / +1`

### –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

```
TrendAnalysisResult.direction
MUST be semantically compatible with CONTRACT_LEXICON.direction.
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ)

* –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ enum, —á—Ç–æ –∏ –≤ `ArchitectureTypes.mqh`
* –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `int` —Å–æ —Å—Ç—Ä–æ–≥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π

---

## 5. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

```
if regime != TREND ‚Üí direction == 0
if regime == RANGE ‚Üí confidence == 0.0
if regime == UNKNOWN ‚Üí direction == 0 AND confidence == 0.0
```

---

## 6. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–∞—Ä–æ–≤ (–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ)

–î–ª—è **–≤—Å–µ—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ —Ä–∞—Å—á—ë—Ç–æ–≤**:

```
k = 0 ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –ó–ê–ö–†–´–¢–´–ô –±–∞—Ä
k = 1 ‚Üí –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–∫—Ä—ã—Ç—ã–π –±–∞—Ä
k = N ‚Üí –±–∞—Ä N –ø–µ—Ä–∏–æ–¥–æ–≤ –Ω–∞–∑–∞–¥
```

‚ùå —Ç–µ–∫—É—â–∏–π (–Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–π) –±–∞—Ä **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**

---

## 7. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ v0.1)

### 7.1 EMA ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

* Period: `EMA_PERIOD = 50`
* Price: `PRICE_CLOSE`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–Ω–∞–∫–ª–æ–Ω EMA**, –∞ –Ω–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è.

---

### 7.2 ADX ‚Äî —Ñ–∏–ª—å—Ç—Ä —Å–∏–ª—ã

* Period: `ADX_PERIOD = 14`
* Threshold: `ADX_MIN = 20`

ADX **–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä.

---

### 7.3 ATR ‚Äî —Ñ–∏–ª—å—Ç—Ä –º–∏–∫—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–π

* Period: `ATR_PERIOD = 14`
* Multiplier: `ATR_MULT = 0.5`

ATR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

* –¥–ª—è –æ—Ç—Å–µ—á–µ–Ω–∏—è —Å–ª–∞–±–æ–≥–æ –Ω–∞–∫–ª–æ–Ω–∞
* –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ confidence

> ‚ö†Ô∏è –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ v0.1:
> ATR —É—á–∞—Å—Ç–≤—É–µ—Ç –∏ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ direction, –∏ –≤ confidence.

---

## 8. Lookback –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### 8.1 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

```
SLOPE_LOOKBACK = 5
```

### 8.2 –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤

```
MIN_BARS =
  max(EMA_PERIOD, ATR_PERIOD, ADX_PERIOD)
  + SLOPE_LOOKBACK
```

### 8.3 –ü—Ä–∞–≤–∏–ª–æ

```
if available_bars < MIN_BARS
  ‚Üí regime = UNKNOWN
  ‚Üí direction = 0
  ‚Üí confidence = 0.0
```

---

## 9. –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è direction

### 9.1 EMA slope

```
delta = EMA[0] ‚àí EMA[SLOPE_LOOKBACK]
```

### 9.2 –ü–æ—Ä–æ–≥

```
abs(delta) ‚â• ATR[0] * ATR_MULT
```

### 9.3 –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

| –£—Å–ª–æ–≤–∏–µ            | direction |
| ------------------ | --------- |
| delta > threshold  | +1        |
| delta < ‚àíthreshold | ‚àí1        |
| –∏–Ω–∞—á–µ              | 0         |

---

## 10. –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è regime

| –£—Å–ª–æ–≤–∏–µ                   | regime  |
| ------------------------- | ------- |
| available_bars < MIN_BARS | UNKNOWN |
| direction == 0            | RANGE   |
| ADX[0] < ADX_MIN          | RANGE   |
| –∏–Ω–∞—á–µ                     | TREND   |

---

## 11. –ê–ª–≥–æ—Ä–∏—Ç–º confidence

### 11.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –í–µ—Å |
| ------------------ | --- |
| EMA slope strength | 0.5 |
| ADX strength       | 0.5 |

---

### 11.2 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

**EMA component**

```
ema_score =
  clamp(
    abs(delta) / (ATR[0] * ATR_MULT),
    0.0, 1.0
  )
```

**ADX component**

```
adx_score =
  clamp(
    (ADX[0] ‚àí ADX_MIN) / ADX_MIN,
    0.0, 1.0
  )
```

---

### 11.3 –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞

```
confidence = 0.5 * ema_score + 0.5 * adx_score
```

---

## 12. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º

* –∫–∞–∂–¥—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**
* –æ–¥–∏–Ω –≤—ã–∑–æ–≤ = –æ–¥–∏–Ω TF
* –Ω–∏–∫–∞–∫–æ–π –∫—Ä–æ—Å—Å-TF –ª–æ–≥–∏–∫–∏

---

## 13. Determinism

TrendAnalyzer v0.1 –û–ë–Ø–ó–ê–ù –±—ã—Ç—å:

* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
* –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
* –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏

–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤—Ö–æ–¥—ã ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

## 14. Visual Observability (–Ω–µ–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –ú–û–ì–£–¢:

* –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ InfoPanel
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
* –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

Visual —Å–ª–æ–π **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é –∏ —Ä–µ—à–µ–Ω–∏—è.

---

## 15. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ v0.1 (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)

TrendAnalyzer v0.1 **–ù–ï**:

* –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–∫—É
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ML
* –ª–æ–≤–∏—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã
* –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç TF
* —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π

---

## 16. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

–ú–æ–¥—É–ª—å —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º, –µ—Å–ª–∏:

* —Å–æ–±–ª—é–¥—ë–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥
* —Å–æ–±–ª—é–¥–µ–Ω—ã MIN_BARS –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
* –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
* –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Observer
* –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç side-effects

---

## 17. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

> **TrendAnalyzer ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏,
> –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∞–π–º—Ñ—Ä–µ–π–º—É
> –∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.**

---

**END OF TECH SPEC ‚Äî TrendAnalyzer v0.1**
